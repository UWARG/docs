<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="University of Waterloo Aerial Robotics Group">
        <link rel="canonical" href="http://www.docs.uwarg.com/picpilot/uart/">
        <link rel="shortcut icon" href="../../../../favicon.ico">
        

	<title>UART - WARG Docs</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">WARG Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Groundstation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../groundstation/">Table of Contents</a>
</li>

                        
                            
<li >
    <a href="../../groundstation/introduction/">Introduction</a>
</li>

                        
                            
<li >
    <a href="../../groundstation/what-you-need-to-know/">What you need to know</a>
</li>

                        
                            
<li >
    <a href="../../groundstation/tutorial/">Tutorial</a>
</li>

                        
                            
<li >
    <a href="../../groundstation/project-structure/">Project Structure</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">PicPilot <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../">Table of Contents</a>
</li>

                        
                            
<li >
    <a href="../introduction/">Introduction</a>
</li>

                        
                            
<li >
    <a href="../pid-loops/">PID Loops</a>
</li>

                        
                            
<li >
    <a href="../pwm-io/">PWM and IO</a>
</li>

                        
                            
<li class="active">
    <a href="./">UART</a>
</li>

                        
                            
<li >
    <a href="../spi/">SPI</a>
</li>

                        
                            
<li >
    <a href="../direct-memory-access/">Direct Memory Access</a>
</li>

                        
                            
<li >
    <a href="../i2c/">I2C</a>
</li>

                        
                            
<li >
    <a href="../datalink/">Datalink</a>
</li>

                        
                            
<li >
    <a href="../analog-to-digital-converter/">Analog to Digital Converter</a>
</li>

                        
                            
<li >
    <a href="../sensors-and-peripherals/">Sensors and Peripherals</a>
</li>

                        
                            
<li >
    <a href="../attitude-control/">Attitude Control</a>
</li>

                        
                            
<li >
    <a href="../path-management/">Path Management</a>
</li>

                        
                            
<li >
    <a href="../resources/">Resources</a>
</li>

                        
                            
<li >
    <a href="../faq/">FAQ</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../computervision/">Computer Vision</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Bootcamps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../bootcamp/mechanical/">Mechanical</a>
</li>

                        
                            
<li >
    <a href="../../bootcamp/computervision/">Computer Vision</a>
</li>

                        
                            
<li >
    <a href="../../bootcamp/embedded/">Software/Hardware</a>
</li>

                        
                            
<li >
    <a href="../../bootcamp/rccompetition/">RC Car Competition</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../tutorials/git/">Git and Github</a>
</li>

                        
                            
<li >
    <a href="../../tutorials/shell/">Using the terminal</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../pwm-io/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../spi/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/UWARG/WARG-Docs">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#uart">UART</a></li>
        
            <li><a href="#in-the-code">In the code</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="uart">UART</h1>
<p>UART stands for Universal Asynchronous Receive Transmit. It is a protocol for chips to be able to communicate between on another. It is a serial form of communication, where each bit of data is transmitted along the same connection. The minimum hardware requirements look like this:</p>
<p><img alt="UART Communication" src="http://i.imgur.com/XtuUHVi.gif" /></p>
<p>Note that Tx represents the transmit port, Rx represents the receive port, and the GND represents the required ground connection.</p>
<p>UART is convenient due to its simplicity. Note that the interface does not have a clock line or any special signalling channels. Most other methods of communication require a pulsing clock to determine the rate at which data is transferred from one component to another. UART is "asynchronous" and therefore the bits on the transfer line and the receive line do not need to be transmitted at the same instance in time. Instead, both chips have a predefined rate at which they transfer binary information to one another. This predefined rate is often determined by the user, or sometimes (very rarely) restricted by the manufacturer. This rate is referred to as the <strong>baud rate</strong>. It is very similar to a bit rate.</p>
<p>As a side note (don't worry if you are confused), Bit rate is the number of <em>bits_transferred per second. Baud rate is the number of _symbols</em> transferred per second. A bit can be 0 or 1. A symbol carries different amounts of information in different technologies. For instance, in certain communication protocols, there can be 64 possible values for a single symbol. 64 values required 6 bits to be represented. Therefore, the baud rate is 6 times less than the bit rate.</p>
<p>For the UART communication protocol, the baud rate is equivalent to the bit rate, although "baud" is the correct terminology.</p>
<p>Although UART can be used in both 8 bit mode and 16 bit mode, the PICpilot uses the 8 bit mode of communication as displayed below.</p>
<ol>
<li>First a start bit is sent</li>
<li>The message is then relayed in series</li>
<li>The stop bit(s) are then sent. (There can be 1 or 2 stop bits)</li>
</ol>
<p>The stop and end bits indicate the beginning and the end of communication.</p>
<table>
<thead>
<tr>
<th><strong>Bit number</strong></th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><strong>Start bit</strong></td>
<td><strong>5â€“8 data bits</strong></td>
<td><strong>Stop bit(s)</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Start</td>
<td>Data 0</td>
<td>Data 1</td>
<td>Data 2</td>
<td>Data 3</td>
<td>Data 4</td>
<td>Data 5</td>
<td>Data 6</td>
<td>Data 7</td>
<td>Stop</td>
<td></td>
</tr>
</tbody>
</table>
<p><img alt="UART Scope" src="http://i.imgur.com/Y6wtYli.jpg" /></p>
<p>The most common settings for the UART protocol include 8 data bits, no parity, 1 stop bit, and no flow control. Remember to make sure that the baud rate matches up, and NEVER connect Tx to Tx or Rx to Rx.</p>
<p>In case you do not know, parity is a special bit used to check the integrity of the data sent. It indicates whether or not the sum of the 8 bits must be odd or even. If this result does not match the parity bit, the microcontroller would know that the information is garbled.</p>
<p>Secondly, flow control requires additional pins, where each peripheral signals the other one before it transmits and receives. This ensures that both chips are ready to communicate.</p>
<p>Thirdly, the terms full duplex and half duplex refer to a chip being able to multitask. Full duplex indicates that both chips send and receive at the same time. Half duplex indicates that only one chip sends and receives at a time. Usually, some type of flow control is required for half duplex systems.</p>
<p>This form of communication is used for two purposes on the PICpilot. It is used for the data link, as well as the debugging interface. The settings are listed below.</p>
<h2 id="in-the-code">In the code</h2>
<p>Each dspic33fj256gp710a has two UART interfaces. They are labeled UART1 and UART2. In the code, two corresponding files are present: UART1.c and UART2.c (as well as their header files). UART1 and UART2 have nearly the same configuration settings, but with slight discrepancies. UART1 is used for debugging purposes. UART2 is used for the wireless transmitter (datalink).</p>
<p>For detailed register maps and specifications of the UART interface, see the <a href="http://www.microchip.com/wwwproducts/Devices.aspx?product=dsPIC33FJ256GP710A">dspic33fj256gp710A</a> datasheet.</p>
<p>The most important settings are listed below.</p>
<h3 id="uart1">UART1</h3>
<pre><code>U1MODEbits.UEN = 0;

U1MODEbits.PDSEL = 0b00;

U1MODEbits.STSEL = 0;

U1BRG = 1;

IPC7 = 0x4400;

IFS0bits.U1TXIF = 0;                // Clear the Transmit Interrupt Flag

IEC0bits.U1TXIE = 0;        // Enable Transmit Interrupts

IFS0bits.U1RXIF = 0;                // Clear the Recieve Interrupt Flag

IEC0bits.U1RXIE = 0;        // Enable Recieve Interrupts

U1MODEbits.UARTEN = 1;        //Enable UART

U1STAbits.UTXEN = 1;        //This must be set after UARTEN - This allows UART to control the Tx pin.
</code></pre>
<table>
<thead>
<tr>
<th>Register</th>
<th>Value</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>U1MODEbits.UEN</td>
<td>0</td>
<td>Enables the Rx and Tx pins and disables the CTS and RTS pins.</td>
</tr>
<tr>
<td>U1MODEbits.PDSEL</td>
<td>0</td>
<td>Configures 8 bit messages with no parity bits.</td>
</tr>
<tr>
<td>U1MODEbits.STSEL</td>
<td>0</td>
<td>Configures 1 stop bit.</td>
</tr>
<tr>
<td>U1BRG</td>
<td>1</td>
<td>Sets the Baud Rate to 115200 Baud.</td>
</tr>
<tr>
<td>IPC7</td>
<td>17408</td>
<td>Sets the priority level for UART interrupts.</td>
</tr>
<tr>
<td>IFS0bits.U1TXIF</td>
<td>0</td>
<td>Clears the transmit interrupt flag.</td>
</tr>
<tr>
<td>IEC0bits.U1TXIE</td>
<td>0</td>
<td>Enables the transmit interrupt event.</td>
</tr>
<tr>
<td>IFS0bits.U1RXIF</td>
<td>0</td>
<td>Clears the receive interrupt flag.</td>
</tr>
<tr>
<td>IEC0bits.U1TXIE</td>
<td>0</td>
<td>Enables the receive interrupt event.</td>
</tr>
<tr>
<td>U1MODEbits.UARTEN</td>
<td>1</td>
<td>Turns UART on.</td>
</tr>
<tr>
<td>U1STAbits.UTXEN</td>
<td>1</td>
<td>Allows transmission (Tx) to take place.</td>
</tr>
</tbody>
</table>
<h3 id="uart2">UART2</h3>
<pre><code>U2MODEbits.UEN = 0;

U2MODEbits.PDSEL = 0b00;

U2MODEbits.STSEL = 0;

U2BRG = 5;

IPC7 = 0x4400;

IFS1bits.U2TXIF = 0;                // Clear the Transmit Interrupt Flag

IEC1bits.U2TXIE = 0;        // Enable Transmit Interrupts

IFS1bits.U2RXIF = 0;                // Clear the Recieve Interrupt Flag

IEC1bits.U2RXIE = 0;        // Enable Recieve Interrupts

U2MODEbits.UARTEN = 1;        //Enable UART

U2STAbits.UTXEN = 1;        //This must be set after UARTEN - This allows UART to control the Tx pin.
</code></pre>
<table>
<thead>
<tr>
<th>Register</th>
<th>Value</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>U1MODEbits.UEN</td>
<td>0</td>
<td>Enables the Rx and Tx pins and disables the CTS and RTS pins.</td>
</tr>
<tr>
<td>U1MODEbits.PDSEL</td>
<td>0</td>
<td>Configures 8 bit messages with no parity bits.</td>
</tr>
<tr>
<td>U1MODEbits.STSEL</td>
<td>0</td>
<td>Configures 1 stop bit.</td>
</tr>
<tr>
<td>U1BRG</td>
<td>5</td>
<td>Sets the Baud Rate to 38400 Baud.</td>
</tr>
<tr>
<td>IPC7</td>
<td>17408</td>
<td>Sets the priority level for UART interrupts.</td>
</tr>
<tr>
<td>IFS0bits.U1TXIF</td>
<td>0</td>
<td>Clears the transmit interrupt flag.</td>
</tr>
<tr>
<td>IEC0bits.U1TXIE</td>
<td>0</td>
<td>Enables the transmit interrupt event.</td>
</tr>
<tr>
<td>IFS0bits.U1RXIF</td>
<td>0</td>
<td>Clears the receive interrupt flag.</td>
</tr>
<tr>
<td>IEC0bits.U1TXIE</td>
<td>0</td>
<td>Enables the receive interrupt event.</td>
</tr>
<tr>
<td>U1MODEbits.UARTEN</td>
<td>1</td>
<td>Turns UART on.</td>
</tr>
<tr>
<td>U1STAbits.UTXEN</td>
<td>1</td>
<td>Allows transmission (Tx) to take place.</td>
</tr>
</tbody>
</table>
<p>Note that the only difference between the data link (UART2) and the debugging interface (UART1), is the rate at which information is sent (baud rate).</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright <a href="http://www.uwarg.com"> University of Waterloo Aerial Robotics Group</a></p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
